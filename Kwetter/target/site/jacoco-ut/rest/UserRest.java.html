<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UserRest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Kwetter</a> &gt; <a href="index.source.html" class="el_package">rest</a> &gt; <span class="el_source">UserRest.java</span></div><h1>UserRest.java</h1><pre class="source lang-java linenums">package rest;

import domain.User;
import dto.UserDTO;
import service.UserService;

import javax.inject.Inject;
import javax.ws.rs.*;

import java.util.List;
import java.util.stream.Collectors;

import static javax.ws.rs.core.MediaType.APPLICATION_JSON;

@Path(&quot;/users&quot;)
public class UserRest {

    @Inject
    private UserService userService;

<span class="nc" id="L21">    public UserRest() {</span>

<span class="nc" id="L23">    }</span>

    /**
     * Route to get all users
     *
     * @return the list of all users in JSON format
     */
    @GET
    @Path(&quot;/&quot;)
    @Produces({APPLICATION_JSON})
    public List&lt;UserDTO&gt; getUsers() {
<span class="nc" id="L34">        return userService.getUsers().stream().map(UserDTO::fromUser).collect(Collectors.toList());</span>
    }

    /**
     * Route to get a specific user with the username
     *
     * @param username the username to find a user with
     * @return a user in JSON format
     */
    @GET
    @Path(&quot;/{username}&quot;)
    @Produces({APPLICATION_JSON})
    public UserDTO getUserByUsername(@PathParam(&quot;username&quot;) String username) {
<span class="nc" id="L47">        return UserDTO.fromUser(userService.getUserByUsername(username));</span>
    }

    /**
     * Route to sign up a new user
     * &lt;p&gt;
     * Required request body JSON format:
     * {
     * &quot;username&quot;: &quot;username&quot;,
     * &quot;password&quot;: &quot;password&quot;
     * }
     * &lt;p&gt;
     * All above fields are required!
     *
     * @param user user instance serialized from request body
     * @return user instance in JSON format when successfully saved in the db
     */
    @POST
    @Consumes({APPLICATION_JSON})
    @Produces({APPLICATION_JSON})
    public int signUp(User user) {
<span class="nc" id="L68">        return userService.register(user);</span>
    }

    /**
     * Route update an existing user's data
     * &lt;p&gt;
     * Required request body JSON format:
     * {
     * &quot;id&quot;: 1,
     * &quot;password&quot;: &quot;updated&quot;,
     * &quot;username&quot;: &quot;updated&quot;,
     * &quot;bio&quot;: &quot;updated&quot;,
     * &quot;web&quot;: &quot;updated&quot;,
     * &quot;imageUrls&quot;: &quot;updated&quot;
     * }
     * &lt;p&gt;
     * Only the id fields are required, all other field will get updated
     * &lt;p&gt;
     * Note: field with the value of null get updated as well so make sure to include values who don't need to get updated
     *
     * @param user user instance serialized from request body
     * @return user instance including in JSON format when successfully saved in the db
     */
    @PUT
    @Consumes({APPLICATION_JSON})
    @Produces({APPLICATION_JSON})
    public UserDTO update(User user) {
<span class="nc" id="L95">        return UserDTO.fromUser(userService.update(user));</span>
    }

    /**
     * Route to authenticated user with login credentials.
     * &lt;p&gt;
     * Required request body JSON format:
     * {
     * &quot;username&quot;: &quot;username&quot;,
     * &quot;password&quot;: &quot;password&quot;
     * }
     * &lt;p&gt;
     * All above fields are required!
     *
     * @param email email
     * @param password password
     * @return user instance in JSON format when found in the db
     */
    @POST
    @Path(&quot;/auth&quot;)
    @Consumes({APPLICATION_JSON})
    @Produces({APPLICATION_JSON})
    public UserDTO authenticate(String email, String password) {
<span class="nc" id="L118">        return UserDTO.fromUser(userService.authenticate(email, password));</span>
    }

    /**
     * Route to delete existing user
     * &lt;p&gt;
     * Will return successful response without content (204) on success
     *
     * @param id the id of the user who needs to be deleted from the db
     */
    @DELETE
    @Path(&quot;/{id}&quot;)
    public void delete(@PathParam(&quot;id&quot;) int id) {
<span class="nc" id="L131">        userService.remove(id);</span>
<span class="nc" id="L132">    }</span>

    /**
     * Route to add a new followOther relation in between two users
     *
     * @param username      the username of the user who is gonna followOther someone else
     * @param otherUsername the username of the user who is going to be followed
     */
    @GET
    @Path(&quot;/followOther/{username}/{otherUsername}&quot;)
    public void addFollower(@PathParam(&quot;username&quot;) String username, @PathParam(&quot;otherUsername&quot;) String otherUsername) {
<span class="nc" id="L143">        User user1 = userService.getUserByUsername(username);</span>
<span class="nc" id="L144">        User user2 = userService.getUserByUsername(otherUsername);</span>

<span class="nc" id="L146">        System.out.println(user1.getUsername());</span>
<span class="nc" id="L147">        System.out.println(user2.getUsername());</span>

<span class="nc bnc" id="L149" title="All 4 branches missed.">        if (user1 == null || user2 == null) {</span>
<span class="nc" id="L150">            return;</span>
        }

<span class="nc" id="L153">        user1.followOther(user2);</span>
<span class="nc" id="L154">        userService.update(user1);</span>
<span class="nc" id="L155">        System.out.println(user1);</span>
<span class="nc" id="L156">    }</span>

    /**
     * Route to remove an existing followOther relation in between two users
     *
     * @param username      the username of the user who is gonna un followOther someone else
     * @param otherUsername the username of the user who is going to be un followed
     */
    @DELETE
    @Path(&quot;/unfollowOther/{username}/{otherUsername}&quot;)
    public void deleteFollower(@PathParam(&quot;username&quot;) String username, @PathParam(&quot;otherUsername&quot;) String otherUsername) {
<span class="nc" id="L167">        User user1 = userService.getUserByUsername(username);</span>
<span class="nc" id="L168">        User user2 = userService.getUserByUsername(otherUsername);</span>

<span class="nc bnc" id="L170" title="All 4 branches missed.">        if (user1 == null || user2 == null) {</span>
<span class="nc" id="L171">            return;</span>
        }

<span class="nc" id="L174">        user1.unfollowOther(user2);</span>
<span class="nc" id="L175">        userService.update(user1);</span>
<span class="nc" id="L176">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.0.201801022044</span></div></body></html>